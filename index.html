<!doctype html>
<html lang="no">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Flappy Quiz â€“ 13th Amendment Edition</title>
<style>
html,body {
  margin:0;
  height:100%;
  background:#0b1c2c;
  color:#f8f9fa;
  font-family: "Inter", system-ui, sans-serif;
  overflow:hidden;
}
canvas {
  display:block;
  margin:0 auto;
  background:linear-gradient(#08213a 0%, #154a7a 100%);
  border-radius:12px;
  box-shadow:0 0 20px rgba(0,0,0,0.4);
}
#modal, #overlay {
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
}
#modal {
  background:rgba(0,0,0,0.7);
  display:none;
}
#overlay {
  display:none;
  font-size:24px;
  color:#ffe66d;
  background:rgba(0,0,0,0.5);
  font-weight:700;
  cursor:pointer;
  text-shadow:0 0 10px #000;
}
.questionBox {
  background:#123;
  border:2px solid #2a9d8f;
  border-radius:10px;
  padding:20px;
  width:90%;
  max-width:600px;
  box-shadow:0 0 20px rgba(0,0,0,0.6);
}
.option {
  margin:6px 0;
  padding:8px 12px;
  border-radius:6px;
  background:#233;
  cursor:pointer;
  transition:background 0.2s;
}
.option:hover { background:#2a9d8f; color:#fff; }
h2 { margin-top:0; }
#restartBtn {
  position:fixed;
  bottom:18px;
  left:50%;
  transform:translateX(-50%);
  background:#2a9d8f;
  border:none;
  border-radius:8px;
  padding:10px 18px;
  color:white;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  box-shadow:0 3px 8px rgba(0,0,0,0.3);
  transition:background 0.2s;
}
#restartBtn:hover { background:#37b99b; }
</style>
</head>
<body>
<canvas id="game" width="900" height="520"></canvas>

<div id="modal">
  <div class="questionBox">
    <h2 id="qText"></h2>
    <div id="answers"></div>
    <p style="font-size:13px;color:#aaa">Svar riktig for Ã¥ passere porten.</p>
  </div>
</div>
<div id="overlay">Trykk mellomrom eller klikk for Ã¥ starte</div>
<button id="restartBtn">ðŸ”„ Restart</button>

<script>
// === Questions ===
const QUESTIONS = [
  {text:"What did the 13th Amendment do?",options:["Ended slavery","Gave women voting rights","Started segregation","Created Jim Crow laws"],correct:0},
  {text:"What was life like for African-Americans after slavery ended?",options:["Easy and equal","Challenging with discrimination","They had full rights","They moved freely without issues"],correct:1},
  {text:"What are Jim Crow laws?",options:["Segregation laws","Tax laws","Education laws","None"],correct:0},
  {text:"What does 'separate but equal' mean?",options:["Equality in education","Segregation justified if facilities were equal","Freedom for all","A civil rights slogan"],correct:1},
  {text:"Were separate facilities really equal?",options:["Yes","No"],correct:1},
  {text:"What were chain gangs?",options:["Groups of slaves","Prison labor groups","Civil rights activists","Farmers unions"],correct:1},
  {text:"What is the three strikes rule?",options:["A baseball term","Law giving life sentence after 3 crimes","Traffic law","Voting rule"],correct:1},
  {text:"Why do some see high incarceration rates as good?",options:["Keeps society safe","Reduces taxes","Improves education","Promotes equality"],correct:0},
  {text:"What is institutionalized slavery?",options:["Slavery within prisons","Manual labor","Voluntary work","None"],correct:0},
  {text:"What issue faced free African-Americans with no voting rights?",options:["They could not influence laws","They had more jobs","They owned land","They traveled freely"],correct:0},
  {text:"What was the Civil Rights Movement?",options:["A protest for racial equality","A war","A new law","A sport event"],correct:0},
  {text:"Who was Rosa Parks?",options:["Civil rights activist","President","Singer","Teacher"],correct:0},
  {text:"What was the Montgomery Bus Boycott?",options:["A protest against bus segregation","A bus company strike","A new law","A riot"],correct:0},
  {text:"Who were The Little Rock Nine?",options:["Nine black students integrating a white school","A music band","Nine civil rights lawyers","Police officers"],correct:0},
  {text:"What message did Martin Luther King Jr. deliver in 'I Have a Dream'?",options:["Hope and equality","Violence","War","Segregation"],correct:0},
  {text:"What was 'Bloody Sunday'?",options:["A march for voting rights attacked by police","A church event","An election day","A movie title"],correct:0},
  {text:"What is social justice?",options:["Fair treatment for all","Justice for criminals","Tax equality","Voting reform"],correct:0},
  {text:"What is the difference between equality and equity?",options:["Equality treats everyone the same, equity gives what is needed","They are the same","Equity is better schools","Equality means money"],correct:0},
  {text:"What is discrimination?",options:["Unfair treatment based on race, gender, etc.","Freedom of speech","Paying taxes","Protesting"],correct:0},
  {text:"What is prejudice?",options:["Judging without knowing someone","Legal equality","Respect","None"],correct:0}
];

const TOTAL = QUESTIONS.length;
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
let W=canvas.width,H=canvas.height;

const GRAVITY=0.35, FLAP=-6.5, GAP=150, PIPE_W=90, SPEED=2.2, SAFE=10; 
let bird={x:150,y:H/2,vy:0,r:18,rot:0};
let pipes=[],running=false,gameOver=false,won=false,showQ=false,answered=new Array(TOTAL).fill(false);
let clouds=[],mountains=[],grass=[];
const modal=document.getElementById("modal"),qText=document.getElementById("qText"),
answers=document.getElementById("answers"),overlay=document.getElementById("overlay"),
restartBtn=document.getElementById("restartBtn");

for(let i=0;i<6;i++) clouds.push({x:Math.random()*W,y:50+Math.random()*150});
for(let i=0;i<4;i++) mountains.push({x:i*W/4,h:120+Math.random()*50});
for(let i=0;i<20;i++) grass.push({x:i*50+Math.random()*40,y:H-20+Math.random()*10});

function reset(){
  bird={x:150,y:H/2,vy:0,r:18,rot:0};
  pipes=[];for(let i=0;i<10;i++) pipes.push(newPipe(i*260+W));
  running=false;gameOver=false;won=false;answered.fill(false);
  overlay.textContent="Trykk mellomrom eller klikk for Ã¥ starte";
  overlay.style.display='flex';
}
function newPipe(x){return {x,w:PIPE_W,gapY:150+Math.random()*(H-300),id:Math.floor(Math.random()*TOTAL),open:false,passed:false};}
function flap(){if(!running||gameOver||won)return;bird.vy=FLAP;}
function showQuestion(id){
  const q=QUESTIONS[id];
  qText.textContent=q.text;
  answers.innerHTML='';
  q.options.forEach((o,i)=>{
    const div=document.createElement('div');
    div.className='option';
    div.textContent=o;
    div.onclick=()=>selectAnswer(id,i);
    answers.appendChild(div);
  });
  modal.style.display='flex';
  running=false;showQ=true;
}
function selectAnswer(id,a){
  const q=QUESTIONS[id];
  if(a===q.correct){answered[id]=true;
    const p=pipes.find(p=>p.id===id&&!p.passed);
    if(p) p.open=true;
    if(answered.filter(Boolean).length===TOTAL) win();
  }else lose("Feil svar!");
  modal.style.display='none';showQ=false;running=true;
}
function lose(msg){gameOver=true;running=false;overlay.textContent="ðŸ’€ "+msg+" â€” Trykk R eller Restart";overlay.style.display='flex';}
function win(){won=true;running=false;overlay.textContent="ðŸŽ‰ Du svarte riktig pÃ¥ alle spÃ¸rsmÃ¥l!";overlay.style.display='flex';}
document.addEventListener('keydown',e=>{
  if(e.code==='Space'){e.preventDefault();
    if(overlay.style.display==='flex'){overlay.style.display='none';running=true;return;}
    flap();
  }
  if(e.code==='KeyR')reset();
});
restartBtn.addEventListener('click',reset);
// Mobil / touch
canvas.addEventListener('touchstart', e => {
    e.preventDefault();  // forhindrer scrolling nÃ¥r man trykker
    if(overlay.style.display === 'flex') {
        // Start spillet hvis overlay vises
        overlay.style.display = 'none';
        running = true;
    } else {
        // Flapp nÃ¥r spillet allerede kjÃ¸rer
        flap();
    }
});

canvas.addEventListener('click',()=>{if(overlay.style.display==='flex'){overlay.style.display='none';running=true;} else flap();});

function update(){
  if(!running||showQ||gameOver||won)return;
  bird.vy+=GRAVITY;bird.vy*=0.98;bird.y+=bird.vy;
  bird.rot=Math.max(-0.4,Math.min(0.9,bird.vy/14));
  for(let p of pipes)p.x-=SPEED;
  if(pipes[0].x+pipes[0].w<-60)pipes.shift(),pipes.push(newPipe(pipes[pipes.length-1].x+260));

  // âœ… FIXED COLLISION: nÃ¥ sjekker pÃ¥ riktig side (inn i rÃ¸ret)
  for(let p of pipes){
    const bx=bird.x,by=bird.y;
    const top=p.gapY-GAP/2,bottom=p.gapY+GAP/2;
    const inPipe = bx + bird.r > p.x + SAFE && bx - bird.r < p.x + p.w - SAFE;
    if(inPipe && !(by>top && by<bottom) && !p.open) lose("Du traff et rÃ¸r!");
    if(!p.passed && bx>p.x+p.w/2){p.passed=true;
      if(!answered[p.id])showQuestion(p.id);
    }
  }
  if(bird.y>H||bird.y<0)lose("Du falt!");
}

function draw(){
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle="#08213a";ctx.fillRect(0,0,W,H);
  ctx.fillStyle="#0e314f";
  for(let m of mountains){ctx.beginPath();ctx.moveTo(m.x,H);ctx.lineTo(m.x+W/4,H);ctx.lineTo(m.x+W/8,H-m.h);ctx.closePath();ctx.fill();}
  ctx.fillStyle="rgba(255,255,255,0.8)";
  for(let c of clouds){ctx.beginPath();ctx.ellipse(c.x,c.y,40,15,0,0,Math.PI*2);ctx.fill();c.x-=0.2;if(c.x<-50)c.x=W+50;}
  for(let p of pipes){
    ctx.fillStyle=p.open?"#6cce8a":"#2a9d8f";
    ctx.fillRect(p.x,0,p.w,p.gapY-GAP/2);
    ctx.fillRect(p.x,p.gapY+GAP/2,p.w,H-(p.gapY+GAP/2));
  }
  ctx.fillStyle="#2a9d8f";for(let g of grass){ctx.fillRect(g.x,g.y,30,10);g.x-=SPEED;if(g.x<-30)g.x=W+30;}
  ctx.save();ctx.translate(bird.x,bird.y);ctx.rotate(bird.rot);
  ctx.fillStyle="#e76f51";ctx.beginPath();ctx.ellipse(0,0,bird.r*1.1,bird.r,0,0,Math.PI*2);ctx.fill();
  ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(6,-5,4,0,Math.PI*2);ctx.fill();
  ctx.fillStyle="#000";ctx.beginPath();ctx.arc(7,-5,2,0,Math.PI*2);ctx.fill();
  ctx.restore();
}
function loop(){update();draw();requestAnimationFrame(loop);}
reset();loop();
</script>
</body>
</html>
